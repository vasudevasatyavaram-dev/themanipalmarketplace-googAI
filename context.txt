Here you will write everything. All context, plan, and blueprint will be written here without exception

**Temporary Change: Dashboard Preview Mode**

**Overview:**
Temporarily disabled the login page to provide a direct preview of the seller dashboard. This is achieved by using a mock user session, allowing for immediate access to the dashboard's features and UI without needing to authenticate. This change is for development and preview purposes only and should be reverted for production.

---

**Feature: Mobile-Friendly Header Navigation**

**Overview:**
To enhance the user experience on mobile devices, the header has been redesigned to be less cluttered. The individual buttons for "Profile," "Best Practices," and "Logout" have been consolidated into a single main menu, accessible via a standard "hamburger" icon (three horizontal bars).

**Behavior:**
1.  **Menu Button:** A new menu icon is located in the top-right corner of the header.
2.  **Opening the Menu:** Tapping or clicking this icon reveals a dropdown menu.
3.  **Menu Options:** The dropdown menu contains the following options, each with a corresponding icon for clarity:
    *   **Dashboard:** Navigates the user back to the main dashboard view.
    *   **Profile:** Opens the profile settings modal.
    *   **Best Practices:** Navigates to the best practices guide.
    *   **Logout:** Signs the user out of the application.
4.  **Closing the Menu:** The menu can be closed by either tapping the menu icon again or by tapping anywhere outside of the menu area.
5.  **Responsive Design:** This change primarily benefits mobile users by saving screen real estate but provides a clean and consistent navigation experience across all screen sizes. The user's email/phone number, previously visible on larger screens, is now also accessible within this menu to maintain a clean header layout.

**Visual Appearance:**
*   The menu icon is styled to match the existing UI elements.
*   The dropdown menu appears directly below the menu icon, with a `brand-cream` background, a subtle border, and a drop shadow to make it stand out from the content below.
*   Menu items have a hover effect to provide visual feedback to the user.

This change streamlines navigation and aligns the dashboard with modern, mobile-first design principles.

---

**Feature: Enhanced Image Cropping Modal**

**Overview:**
To improve the usability of the image cropper, especially for large portrait-oriented images, the cropping modal has been significantly enlarged. Previously, tall images would be scaled down to fit, making it difficult to see the full picture for precise cropping.

**Behavior & Visuals:**
1.  **Increased Modal Size:** The modal window is now wider (from `max-w-lg` to `max-w-3xl`), providing a larger canvas for the cropping tool.
2.  **Taller Image Preview:** The maximum height for the image preview has been increased from `50vh` to `70vh` (70% of the screen's height). This ensures that even tall portrait images are fully visible, allowing sellers to easily and accurately select their desired crop.
3.  **Responsive Design:** The modal remains fully responsive and will adapt to smaller screen sizes appropriately.

This change provides a much better user experience for editing product images, leading to better-quality product photos on the marketplace.

---

**UI Tweak: Reorder Image Crop Aspect Ratios**

**Overview:**
To improve the workflow for sellers, the order of the aspect ratio presets in the image cropping modal has been adjusted. The "Auto" (freeform) option is now listed first, giving users immediate access to the most flexible cropping method, while "Square" is still maintained as the default selection upon opening the modal.

**Behavior:**
1.  **New Preset Order:** The buttons for aspect ratio selection now appear in the following order: **Auto, Square, Portrait, Landscape**.
2.  **Default Aspect Ratio:** The initial crop selection remains **Square (1:1)**, as this is the recommended format for consistency. The "Square" button is highlighted by default when the modal opens.
3.  **Functionality:** Clicking on any of the preset buttons changes the aspect ratio of the crop selection as it did before.

This minor adjustment enhances user experience by making the most flexible cropping option more prominent and accessible.

---

**UI Fix: Immediate Aspect Ratio Update in Image Cropper**

**Overview:**
A fix has been implemented in the image cropping modal to address a usability issue. Previously, when a user selected a new aspect ratio preset (e.g., "Portrait," "Landscape"), the cropping rectangle would not visually update to the new shape until the user manually interacted with it.

**Behavior Change:**
1.  **Immediate Visual Feedback:** Now, upon clicking an aspect ratio button, the cropping selection immediately and automatically reshapes itself to match the selected aspect ratio (e.g., clicking "Landscape" instantly changes the crop to a 16:9 rectangle).
2.  **Centered Crop:** The new crop is centered on the image and maintains a size of 90% of the image's dimensions, providing a sensible default that the user can then fine-tune.

This fix makes the cropping tool more intuitive and responsive, improving the overall user experience during the product listing process.

---

**UI Change: Reorder Product Forms for Better Workflow**

**Overview:**
To improve the user workflow when adding or editing a product, the fields in both the "Add New Product" and "Edit Product" modals have been reordered. The current layout required sellers to handle images first, which can interrupt the flow of entering product details.

**Behavior Change:**
The image management section (including the drag-and-drop area and image previews) has been moved from the top of the form to the bottom. This allows sellers to first fill out or update all the textual details of their product (Title, Description, Price, etc.) and then manage the image uploads as the final step.

**New Form Order (for both Add & Edit Modals):**
1.  Product Title
2.  Product Description
3.  Categories & Type
4.  Price & Quantity
5.  **Product Images** (drag-and-drop area and previews)

This change creates a more logical and linear process for listing and editing products, enhancing usability and providing a consistent experience across the dashboard.

---

**UI Fix: Robust Image Preview for All Aspect Ratios**

**Overview:**
An issue in the product forms has been fixed where image previews, particularly for landscape-oriented images, did not display correctly. They sometimes appeared stretched or improperly scaled instead of being "letterboxed" within their square containers.

**Behavior Change:**
1.  **Universal Aspect Ratio Support:** The image preview container styling has been made more robust. It now correctly displays images of *any* aspect ratio (portrait, landscape, square, or custom).
2.  **Correct Scaling and Centering:** By wrapping the image in a flexbox container, it is guaranteed to be perfectly centered both horizontally and vertically. It is scaled down to fit entirely within the square preview box while maintaining its true aspect ratio.
3.  **Visible Background:** The empty space around the image (pillarboxing for tall images, letterboxing for wide images) now correctly shows the container's white background, providing an accurate and clean preview of the final cropped image.

This change ensures that sellers see an exact representation of their cropped images, regardless of the shape, providing confidence in how their product will be displayed on the marketplace.

---

**UI/UX Improvement: Reposition Image Preview Delete Button**

**Overview:**
To improve usability and prevent accidental deletions, the delete button on the image previews within the "Add Product" and "Edit Product" forms has been repositioned.

**Behavior Change:**
1.  **New Position:** The delete button, which appears when a user hovers over an image preview, is no longer in the center. It is now located in the **top-right corner**, a more standard and less intrusive position.
2.  **Visual Style:** The button now has a semi-transparent background, ensuring the 'delete' icon is clearly visible regardless of the image content. The hover effect has been retained to provide clear feedback.
3.  **Consistency:** This change is applied to all image previews in both the "Add Product" and "Edit Product" modals for a consistent user experience.

This change makes the image management process safer and more user-friendly by reducing the risk of frustrating mistakes.

---

**Feature: Re-Croppable Image Previews**

**Overview:**
A significant enhancement has been made to the image upload workflow. Previously, once a crop was applied to an image, it was final. Now, sellers have the ability to go back and adjust the crop of any uploaded image directly from the thumbnail preview before submitting the form.

**Behavior Change:**
1.  **"Edit Crop" Button:** Each image thumbnail in the "Add Product" and "Edit Product" forms now features a new "Edit Crop" icon that appears on hover, next to the delete button.
2.  **Re-Opening the Cropper:** Clicking this icon opens the Image Crop modal again, loading the *original, un-cropped image*.
3.  **Preserved Crop Settings:** The cropper will automatically be set to the user's last saved crop for that image, allowing them to make adjustments from where they left off instead of starting over.
4.  **Underlying Data Management:** To make this possible, the application now temporarily stores the original image file in the browser's memory, alongside the specific crop settings. The final, cropped image is only generated and uploaded to Supabase upon final submission of the product form.

This feature provides a more forgiving and powerful image editing experience, ensuring sellers can perfect their product photos with ease.

---

**UI/UX Tweak: Optimized Image Action Button Placement**

**Overview:**
To enhance mobile usability and create a more intuitive interface, the placement of the action buttons on image previews has been refined.

**Behavior Change:**
1.  **Centered Primary Action:** The "Edit Crop" button now appears directly in the center of the image thumbnail on hover. This makes it the primary, most easily accessible action, especially on touch devices.
2.  **Cornered Secondary Action:** The "Delete" button has been moved to the top-right corner of the thumbnail. This is a conventional and safe placement for a destructive action, significantly reducing the chance of accidental taps.
3.  **Consistency:** This new, more intuitive layout is applied to all image previews in both the "Add Product" and "Edit Product" forms.

This separation of actions provides a cleaner, more organized, and safer user experience.

---

**UI Fix: Perfect Re-Crop State Restoration**

**Overview:**
To create a more reliable and seamless re-cropping experience, the underlying logic of the Image Crop modal has been refactore. Instead of deriving the crop mode by calculating aspect ratios (which could lead to floating-point errors), the system now explicitly stores the user's selected mode (e.g., 'auto', 'square', 'portrait') in the application's state.

**Behavior Change:**
1.  **Direct State Storage:** When a crop is applied, both the crop coordinates and the selected mode are saved.
2.  **Perfect State Restoration:** When a user clicks "Edit Crop," the modal now uses this saved mode to instantly and accurately highlight the correct aspect ratio button and restore the exact crop, completely eliminating the previous guesswork and potential for errors.

This change ensures the re-cropping feature is not only more efficient but also perfectly reliable, correctly preserving the user's intent and providing a frustration-free editing experience.

---

**UI Tweak: "Auto" Crop Mode Improvement**

**Overview:**
To enhance the usability of the image cropper, the behavior of the "Auto" aspect ratio mode has been refined.

**Behavior Change:**
1.  **Square Default for "Auto":** When a user clicks the "Auto" button, the cropping selection now immediately defaults to a centered square shape.
2.  **Immediate Free-form Resizing:** After this initial square is set, the aspect ratio lock is released, and the user can immediately resize the crop to any dimension they wish, as is expected from an "Auto" mode.

This change provides a more predictable and intuitive starting point for free-form cropping, improving the overall user experience.

---

**Authentication Flow Re-enabled**

**Overview:**
The temporary "preview mode," which used a mock user session to bypass the login screen, has been reverted. The application's original, production-ready authentication flow has been restored.

**Behavior Change:**
1.  **Login Required:** Users will now be presented with the login/sign-up page upon visiting the application.
2.  **Supabase Authentication:** The app now communicates with Supabase Authentication to manage user sessions. It will fetch the current session on load and listen for any changes in authentication state (e.g., login, logout).
3.  **Secure Access:** The seller dashboard is now protected and can only be accessed by authenticated users.

This change moves the application from a development preview state to a production-ready state with a fully functional and secure authentication system.

---

**Feature: Rental Session Field**

**Overview:**
To support product rentals, a new "Session" field has been added. This field allows sellers to specify the duration or unit for which a rental price applies (e.g., "per night," "per hour").

**Behavior & UI Changes:**
1.  **Conditional Field:** In both the "Add Product" and "Edit Product" forms, a new text input for "Rental Session" will now appear. This field is only visible when the product "Type" is set to "Rent."
2.  **Required for Rentals:** This field is mandatory for all rental listings.
3.  **Product Card Display:** On the main dashboard, the product cards for rental items will now display the price along with its session (e.g., "Rental Price: ₹1500 / per night"), providing clear information to the seller.
4.  **Database Integration:** The session information is stored in a new `session` column in the database, which is constrained to only accept values for rental items.

This feature provides the necessary functionality for a rental marketplace while keeping the UI for standard "Buy" listings clean and uncluttered.

---

**UI Tweak: De-emphasize Product Delete Button**

**Overview:**
To improve the visual hierarchy and reduce the prominence of the destructive "Delete" action on product cards, its styling has been updated to be less conspicuous.

**Behavior & Visual Change:**
1.  **From Solid to Outline:** The "Delete" button no longer has a solid, bright red (`brand-accent`) background. It has been changed to a more subtle "outline" style.
2.  **New Styling:** The button now has a transparent background with a `brand-accent` colored border and text. On hover, the background fills with the `brand-accent` color, and the text turns white, providing clear feedback without being overly dominant in its resting state.

This change makes the "Edit" button the most visually neutral action, while the "Delete" button is clearly marked as a secondary, more dangerous option.

---

**Feature: Image Carousel on Product Cards**

**Overview:**
To improve the product viewing experience on the main dashboard, an image carousel has been added to the product cards. Sellers can now cycle through all uploaded images for a product directly from the product list.

**Behavior & Visual Changes:**
1.  **Carousel Functionality:** For products with more than one image, the image display area on the card now functions as a carousel.
2.  **Navigation Arrows:**
    *   When hovering over the image, left and right navigation arrows will appear on the sides.
    *   Clicking these arrows allows the seller to cycle through the product's images. The carousel will loop, meaning clicking "next" on the last image will go to the first, and "previous" on the first image will go to the last.
3.  **Page Indicators:**
    *   Small dot indicators are now displayed at the bottom of the image area.
    *   These dots show the total number of images available and highlight which one is currently being viewed.

This feature is only active for products with multiple images, keeping the interface for single-image products clean and unchanged. This enhancement provides a richer, more interactive dashboard experience.

---

**UI Tweak: Display Session in Version History**

**Overview:**
To maintain consistency with the main product list, the Version History modal has been updated to display the rental session information for products listed for rent.

**Behavior & Visual Change:**
- In the details section for each version, if a product is a rental, the price will now be displayed along with its session (e.g., "Rental Price: ₹1500 / per night"). This ensures that sellers have a complete view of their product's history, including rental terms.

---

**UI/UX Improvement: Refine Product Card Actions**

**Overview:**
To create a clearer and more intuitive workflow for sellers, the action buttons ("Edit," "History," "Delete") on the product cards have been updated. The "Edit" and "History" buttons are now hidden for approved products, and the layout dynamically adjusts to the number of visible buttons.

**Behavior & Visual Changes:**
1.  **Hide Buttons for Approved Products:** The "Edit" and "History" buttons are no longer visible on product cards where the `approval_status` is 'approved'. This clarifies that approved listings are live and cannot be directly modified.
2.  **Enable Editing for Rejected Products:** Sellers can now click "Edit" on a rejected product. This allows them to correct any issues based on rejection feedback and resubmit the product for approval.
3.  **Dynamic Button Layout:** The button container now uses a flexible layout, so the buttons automatically and evenly share the available space. This ensures the layout always looks balanced and professional, whether one, two, or three buttons are visible.

---
**UI/UX Improvement: Rejected Product Workflow**

**Overview:**
To improve the seller's experience when dealing with rejected products, several UI and functional refinements have been made. These changes provide clearer instructions and prevent users from reverting to a known problematic state.

**Behavior & Visual Changes:**
1.  **"Resubmit" Button:** On the main product list, the action button for a rejected product, which was previously labeled "Edit," has been renamed to **"Resubmit."** This makes the intended action much clearer to the user. The functionality remains the same—it opens the edit modal, allowing the seller to make corrections and submit a new version.
2.  **Version History Refinement:** In the "Version History" modal:
    *   Any version that was rejected is now visually de-emphasized with a reduced opacity ("dulled out").
    *   A "Rejected" status badge has been added next to the version number for clarity.
    *   The **"Revert to this version"** button is now disabled for any rejected version. This prevents sellers from accidentally reverting their product to a state that has already failed the approval process.